jQuery.event.props.push("clipboardData");RMPlus.Usability=(function(b){var b=b||{};b.pasteImageName=function(m,o){var l="!"+o+"! ";var e=m.scrollTop;var k=((m.selectionStart||m.selectionStart=="0")?1:(document.selection?2:false));if(k==2){m.focus();var p=document.selection.createRange();p.moveStart("character",-m.value.length);strPos=p.text.length}else{if(k==1){strPos=m.selectionStart}}var n=(m.value).substring(0,strPos);var a=(m.value).substring(strPos,m.value.length);if(n.length==0||n.slice(-1)=="\n"){m.value=n+l+a}else{m.value=n+" "+l+a}strPos=strPos+l.length;if(k==2){m.focus();var p=document.selection.createRange();p.moveStart("character",-m.value.length);p.moveStart("character",strPos);p.moveEnd("character",0);p.select()}else{if(k==1){m.selectionStart=strPos;m.selectionEnd=strPos;m.focus()}}m.scrollTop=e};b.getDataItems=function(i,k,n,a){i.items=[];for(var p=0;p<i.types.length;p++){var l=i.getData(i.types[p]);if(i.types[p]=="text/html"){$("<div>"+l+"</div>").find("img").each(function(){var c=new XMLHttpRequest();c.addEventListener("load",function(){if(c.status==200){var d={};d.getAsFile=function(){return c.response};d.type=c.response.type;i.items.push(d);b.processClipboardItems(i,k,n,a)}});c.open("GET",this.src);c.responseType="blob";c.send(null)})}else{if(i.types[p]=="text/plain"){var o=/file:\/\/.*/;var m=new RegExp(o);if(l.match(m)){alert("Your browser does not support pasting images from disk. Please use the upload form.")}}}}};b.processClipboardItems=function(r,p,t,a){for(var q=0;q<r.items.length;q++){if(r.items[q].type.indexOf("image/")!=-1){var s="";switch(r.items[q].type){case"image/gif":s=".gif";break;case"image/jpeg":case"image/jpg":case"image/pjpeg":s=".jpg";break;case"image/png":s=".png";break;case"image/svg+xml":case"image/svg":s=".svg";break;case"image/tiff":case"image/tif":s=".tiff";break;case"image/bmp":case"image/x-bmp":case"image/x-ms-bmp":s=".bmp";break}if(s!=""){var m=a.get(0);var n=Math.round(+new Date()/1000);var o=addFile.nextAttachmentId;var u="screenshot_"+o+"_"+n+s;var v=r.items[q].getAsFile();v.name=u;uploadAndAttachFiles([v],m);$("#attachments_"+o).find('input[name="attachments['+o+'][filename]"]').val(u);b.pasteImageName(p,u)}t.preventDefault();t.stopPropagation();break}}};return b})(RMPlus.Usability||{});$(document).ready(function(){$(document.body).on("paste",".wiki-edit",function(d){var e=undefined;if((e=$(this).parents(["#sd_button_panel",".request_comment_form","div.box:visible:first"]).find("input:file:first")).length!=1){return}var f;if(document.attachEvent){f=window.clipboardData}else{f=d.clipboardData||d.originalevent.clipboardData}if(!f.items){RMPlus.Usability.getDataItems(f,this,d,e)}else{RMPlus.Usability.processClipboardItems(f,this,d,e)}});$(document.body).on("click","#attachments_fields input.filename.readonly",function(){RMPlus.Usability.pasteImageName($(this).parents(["#sd_button_panel",".request_comment_form","div.box:visible:first"]).find("textarea.wiki-edit:visible:last").get(0),this.value)})});