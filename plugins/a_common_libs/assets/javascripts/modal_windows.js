$(document).ready(function(){$(document.body).on("click",".link_to_modal:not(.mw-link)",function(a){a.preventDefault();$(this).modal_window("click_to_link")});$(document).ajaxStop(function(){$("body > div.modal_window:not(.mw-dynamic)").modal_window("destroy_if_needed")})});!function(b){var a=function(d,c){this.current_id=RMPlus.Utils.create_guid();this.$element=b(d);this.$element.addClass("mw-link");this.options=b.extend(true,{},b.fn.modal_window.defaults,c||{});this.loaded=false;this.detect_link_options();this.detect_modal_window();this.detect_mask();if(this.options.link_opts.over_parent_window){this.$parent_window=this.$element.closest("div.modal_window");if(this.$parent_window.length==0){this.$parent_window=undefined;this.options.link_opts.over_parent_window=false}}this.visible=false;this.loading=false;this.listen()};a.prototype={constructor:a,detect_link_options:function(){var d=this.$element.attr("class");if(d&&d.length>0){d=d.split(" ");var c="";for(var e=0;e<d.length;e++){c=d[e].replace("-","_");if(this.options.link_opts[c]==false){this.options.link_opts[c]=true}}}},detect_modal_window:function(){if(this.$window){return}var d=this.$element.attr("id");if(!d||d.length==0){d=RMPlus.Utils.create_guid()}var c=b("#modal-"+d);if(c.length==0){this.$window=b("<div id='modal-"+d+"' class='modal_window"+(this.options.link_opts.click_out?" click_out":"")+"'></div>")}else{this.$window=c;if(this.$window.text()!=""){this.loaded=true}}this._append_mobile_close();this.$window.css("z-index",b.fn.modal_window.z_index);this.$window.data("modal_window",this);b(document.body).prepend(this.$window)},detect_mask:function(){if(this.$mask){return}this.$mask=b("<div class='mw-drop-mask'></div>");b(document.body).prepend(this.$mask)},listen:function(){this.$element.on("click.modal_window",b.proxy(this.click_to_link,this));if(!this.options.link_opts.click_out){this.$window.on("mouseleave.modal_window",b.proxy(this.mouse_leave_window,this))}this.$mask.on("click.modal_window",b.proxy(this.hide,this));this.$window.on("click.modal_window",".mw-close",b.proxy(this.hide,this));b(window).resize(b.proxy(this.window_resize,this))},click_to_link:function(c){if(c){c.preventDefault()}this.$window.data("modal_window",this);if(this.options.link_opts.refreshable||(!this.loaded&&!this.options.link_opts.static_content_only)){this.load()}else{this.show()}},mouse_leave_window:function(c){if(c.target.nodeName.toLowerCase()!="select"&&!b.contains(this.$window[0],c.target)){this.hide()}},window_resize:function(){if(this.visible){this.show()}},hide_windows:function(c){c=c||b(document.body);c.find(".modal_window:visible").not(this.$window).modal_window("hide")},show:function(){var c={};if(this.options.link_opts.mw_mobile){c=this._get_position_mobile();this.$window.css("height",c.height);this.$window.css("width",c.width)}else{c=this._get_position()}this.$window.css("left",c.left);this.$window.css("top",c.top);this.$window.removeClass(this.options.window_top_class+" "+this.options.window_bottom_class+" "+this.options.window_left_class+" "+this.options.window_right_class+" "+this.options.window_block_class);this.$window.addClass(c.class_lr).addClass(c.class_tb).addClass(c.class_block);if(!this.visible){if(this.options.link_opts.over_parent_window){this.$window.zIndex(this.$parent_window.zIndex()+2)}this.$window.show().trigger("modal_window_shown");this.show_mask();this.$element.trigger("modal_window_shown");this.visible=true;this.$window.find("input, select, textarea").filter(":visible:first").focus();if(this.options.link_opts.over_parent_window){this.hide_windows(this.$parent_window)}else{this.hide_windows()}}},hide:function(){if(this.visible){this.$window.hide().trigger("modal_window_hidden");this.$element.trigger("modal_window_hidden");this.hide_mask();this.visible=false}},show_mask:function(){if(this.$window.prev()[0]!==this.$mask[0]){this.$window.before(this.$mask)}this.$mask.zIndex(this.$window.zIndex()-1);this.$mask.css(this._make_mask_css()).addClass("mw-mask-show");b(window).on("resize.modal_window."+this.current_id,b.proxy(function(){this.$mask.css(this._make_mask_css())},this))},hide_mask:function(){this.$mask.removeClass("mw-mask-show");b(window).off("resize.modal_window."+this.current_id)},load:function(){if(this.loading){return}this.loading=true;this.append_loader();var c={};if(this.$element[0].tagName=="A"){c.url=this.$element.attr("href");c.type=(this.$element.attr("data-method")||this.$element.attr("data-modal-method")||"").toUpperCase()||"GET"}else{var d=this.$element.closest("form");c.url=d.attr("action");c.data=d.serialize();c.type=(d.attr("method")||"").toUpperCase()||"GET"}if(b.fn.jquery>="1.9"){c.method=c.type;delete c.type}b.ajax(c).always(b.proxy(function(e){this.complete_load(e.responseText||e)},this))},append_loader:function(){var e=this.$element;if(this.options.link_opts.parent_loader){e=this.$element.closest(".parent_loader")}var f=e.offset();var d=e.outerHeight();var c=e.outerWidth();e.addClass("invisible_link");this.$loader_object=e;if(!this.$loader){this.$loader=b('<div class="mw_loader loader">&nbsp;</div>')}b(document.body).append(this.$loader);this.$loader.css("left",f.left).css("top",f.top).css("width",c).css("height",d).show()},remove_loader:function(){if(this.$loader_object){this.$loader_object.removeClass("invisible_link");this.$loader_object=undefined}if(this.$loader){this.$loader.remove()}},complete_load:function(c){this.remove_loader();this.$window.html(c);this._append_mobile_close();this.loading=false;this.loaded=true;this.show()},destroy_if_needed:function(){if(this.$window&&this.$element&&!b.contains(document.documentElement,this.$element[0])){this.destroy()}},destroy:function(){this.$window.remove();this.$window=undefined;this.$mask.remove();this.$mask=undefined;this.$element.removeClass("mw-link");this.$element.off(".modal_window").removeData("modal_window");b(window).off("resize.modal_window."+this.current_id);this.$element=undefined},_get_position:function(f){var d={top:b(document).scrollTop(),left:b(document).scrollLeft()};var j=f;if(!j){j=this.$element.offset();j.top=j.top-d.top;j.left=j.left-d.left}j.width=j.width||this.$element.outerWidth();j.height=j.height||this.$element.outerHeight();var i=this.$window.outerWidth();var e=this.$window.outerHeight();var h=b(window).outerWidth();var c=b(window).outerHeight();var g=7;j.class_lr=j.width==0?"":this.options.window_right_class;j.class_tb=j.width==0?"":this.options.window_bottom_class;j.class_block="";if(this.options.link_opts.block_preferred){j.class_block=this.options.window_block_class;if((this.options.link_opts.left_preferred||h<i+j.left)&&i<j.left+j.width){j.left=j.left+j.width+g}else{j.width=-g}if((this.options.link_opts.top_preferred||c<e+j.top+j.height)&&e<j.top){j.height=0}else{j.top=j.top+j.height}}if((this.options.link_opts.left_preferred||h<i+j.left+j.width+g)&&i<j.left){j.left=j.left-g-i+d.left;j.class_lr=this.options.window_left_class}else{j.left=j.left+j.width+g+d.left}if((this.options.link_opts.top_preferred||c<j.top+e-j.height)&&e<j.top+j.height){j.top=j.top+d.top+j.height-e;j.class_tb=this.options.window_top_class}else{j.top=j.top+d.top}delete j.width;delete j.height;return j},_get_position_mobile:function(){var c={};c.top=0;c.left=0;c.width=b(window).outerWidth();c.height=b(window).outerHeight();c.class_lr="";c.class_tb="";c.class_block="";return c},_append_mobile_close:function(){if(this.options.link_opts.mw_mobile){this.$window.addClass("mw-mobile");if(this.$window.find(".mw-close").length==0){this.$window.prepend('<div class="mw-close fa"></div>')}}},_make_mask_css:function(){return{width:Math.max(document.documentElement.scrollWidth,b(window).width()),height:Math.max(document.documentElement.scrollHeight,b(window).height())}}};b.fn.modal_window=function(c){return this.each(function(){var f=b(this),e=f.data("modal_window"),d=typeof c=="object"&&c;if(!e){if(f.hasClass("modal_window")){return}f.data("modal_window",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.modal_window.defaults={window_top_class:"mw-top",window_bottom_class:"mw-bottom",window_left_class:"mw-left",window_right_class:"mw-right",window_block_class:"mw-block",link_opts:{click_out:false,over_parent_window:false,static_content_only:false,refreshable:false,parent_loader:false,block_preferred:false,left_preferred:false,top_preferred:false,mw_mobile:false}};b.fn.modal_window.z_index=1100;b.fn.modal_window.Constructor=a}(window.jQuery);!function(a){var b=function(d,c){this.current_id=RMPlus.Utils.create_guid();this.options=a.extend(true,{},a.fn.modal_window.defaults,c||{});this.$window=a(d);this.detect_options();this._append_mobile_close();this.$window.css("z-index",a.fn.modal_window.z_index);a(document.body).prepend(this.$window);this.detect_mask();this.visible=false;this.listen()};b.prototype=a.extend({},a.fn.modal_window.Constructor.prototype,{constructor:b,detect_options:function(){var d=this.$window.attr("class");if(d&&d.length>0){d=d.split(" ");var c="";for(var e=0;e<d.length;e++){c=d[e].replace("-","_");if(c in this.options.link_opts&&this.options.link_opts[c]==false){this.options.link_opts[c]=true}}}},listen:function(){if(!this.options.link_opts.click_out){this.$window.on("mouseleave.modal_window_single",a.proxy(this.mouse_leave_window,this))}this.$mask.on("click.modal_window_single",a.proxy(this.hide,this));this.$window.on("click.modal_window_single",".mw-close",a.proxy(this.hide,this));a(window).resize(a.proxy(this.window_resize,this))},window_resize:function(){if(this.visible&&this.current_point){this.show(this.current_point)}},show:function(c){this.current_point=c;var d={};if(this.options.link_opts.mw_mobile){d=this._get_position_mobile();this.$window.css("height",d.height);this.$window.css("width",d.width)}else{d=this._get_position({top:c.top,left:c.left,width:1,height:1})}this.$window.css("left",d.left);this.$window.css("top",d.top);this.$window.removeClass(this.options.window_top_class+" "+this.options.window_bottom_class+" "+this.options.window_left_class+" "+this.options.window_right_class+" "+this.options.window_block_class);this.$window.addClass(d.class_lr).addClass(d.class_tb).addClass(d.class_block);if(!this.visible){this.$window.show().trigger("modal_window_shown");this.show_mask();this.visible=true;this.$window.find("input, select, textarea").filter(":visible:first").focus();if(this.options.link_opts.over_parent_window){this.hide_windows(this.$parent_window);this.$window.zIndex(this.$parent_window.zIndex()+2)}else{this.hide_windows()}}},hide:function(){if(this.visible){this.$window.hide().trigger("modal_window_hidden");this.hide_mask();this.visible=false}},destroy_if_needed:function(){return false},destroy:function(){this.$mask.remove();this.$mask=undefined;this.$window.off(".modal_window_single").removeData("modal_window_single");a(window).off("resize.modal_window."+this.current_id);this.$window=undefined}});a.fn.modal_window_single=function(c){return this.each(function(){var f=a(this),e=f.data("modal_window_single"),d=typeof c=="object"&&c;if(!e){f.data("modal_window_single",(e=new b(this,d)))}if(typeof c=="string"){e[c]()}})};a.fn.modal_window_single.Constructor=b}(window.jQuery);