if(!Array.prototype.indexOf){Array.prototype.indexOf=function(a,c){for(var b=c||0,d=this.length;b<d;b++){if(this[b]===a){return b}}return -1}}(function(a){a.fn.changeElementType=function(c){var b={};a.each(this[0].attributes,function(e,d){b[d.nodeName]=d.nodeValue});this.replaceWith(function(){return a("<"+c+"/>",b).append(a(this).contents())})};a.fn.isNumber=function(b){return !isNaN(parseFloat(b))&&isFinite(b)}})(jQuery);(function(a){a.fn.outerHTML=function(){return a(this).clone().wrap("<div></div>").parent().html()}})(jQuery);var TabIsVisible=(function(){var c,a,b={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(c in b){if(c in document){a=b[c];break}}return function(d){if(d){document.addEventListener(a,d)}return !document[c]}})();var RMPlus=(function(a){var a=a||{};return a})(RMPlus||{});RMPlus.Utils=(function(a){var a=a||{};a.uniq_id=function(){var c=new Date();var b=Math.random().toString().split(".")[1];rm_id=c.getHours().toString()+c.getMinutes().toString()+c.getSeconds().toString()+c.getMilliseconds().toString()+"-"+b;return rm_id};a.exists=function(f){obj=RMPlus;var e=f.split(".");for(var d=0,b=e.length;d<b;d++){var c=e[d];if(obj!==null&&typeof obj==="object"&&c in obj){obj=obj[c]}else{return false}}return true};a.debounce=function(b,c){var d=null;return function(){var f=this,e=arguments;clearTimeout(d);d=setTimeout(function(){c.apply(f,e)},b)}};a.throttle=function(b,d,c){b||(b=250);var e,f;return function(){var i=c||this;var h=+new Date,g=arguments;if(e&&h<e+b){clearTimeout(f);f=setTimeout(function(){e=h;d.apply(i,g)},b)}else{e=h;d.apply(i,g)}}};a.async_tab_load=function(c,d,b){c.attr("data-remote","true");c.attr("href",b).click(function(){if(d.attr("data-loaded")){$(this).removeAttr("data-remote");return}d.attr("data-loaded",1)})};a.append_fast_links=function(){var b=$('<a href="#" class="icon icon-edit rmp-fast-link no_line" target="_blank"></a>');$("select.rmp-fast-edit").each(function(){var d=$(this);if(d.data("rmp-fast-link")){return}var c=b.clone();if(d.hasClass("select2-hidden-accessible")){d.data("rmp-fast-link",c).next().after(c)}else{d.after(c).data("rmp-fast-link",c)}if(d.attr("modal")){c.addClass("link_to_modal click_out refreshable")}}).trigger("change")};a.get_params_from_url=function(c){var f={};if(c==="undefined"||c==undefined){var e=window.location.search.substring(1)}else{var e=c.split("?")[1]}var g=e.split("&");for(var d=0;d<g.length;d++){var h=g[d].split("=");if(typeof f[h[0]]==="undefined"){f[h[0]]=decodeURIComponent(h[1])}else{if(typeof f[h[0]]==="string"){var b=[f[h[0]],decodeURIComponent(h[1])];f[h[0]]=b}else{f[h[0]].push(decodeURIComponent(h[1]))}}}return f};a.create_guid=function(){var c=new Date().getTime();var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var d=(c+Math.random()*16)%16|0;c=Math.floor(c/16);return(e=="x"?d:(d&3|8)).toString(16)});return b};a.acl_upload_icon=function(c){if(!c.id){return c.text}var b=c.id.toLowerCase();if((/^fa-/).test(c.id)){b+=" rm-icon"}return"<span class='lu_img no_redirect "+b+"' href='#' style='border-bottom: none;'>"+c.text+"</span>"};a.find_upload_css_styles=function(e){var d=[];var f=document.styleSheets;for(var c=0;c<f.length;c++){var b=document.styleSheets[c].cssRules;for(var h=0;h<b.length;h++){if(typeof b[h].selectorText!="undefined"){var g=e?/(^\.sd_btn_)|(^\.lb_btn_)|(^\.acl_icon_)/:/(^\.sd_btn_)|(^\.lb_btn_)|(^\.acl_icon_)|\.fa-(.*):before/;if(g.test(b[h].selectorText)){d.push(b[h].selectorText.split("::before")[0])}}}}return d};a.acl_prepare_css_styles=function(i,f){var h=a.find_upload_css_styles(f);var d=i.val();for(var g=0;g<h.length;g++){var c=h[g].split(".")[1];var b=c.split(/sd_btn_|lb_btn_|acl_icon_/);b=(b.length==2)?b[1]:b[0];if(i.find("option[value='"+c+"']").length==0){i.append($("<option></option>").val(c).html(b).attr("data-test",1))}}var e=i.find("option").sort(function(k,j){if($(k).val()>$(j).val()){return 1}else{if($(k).val()<$(j).val()){return -1}else{return 0}}});i.empty().append(e);i.val(d)};a.wordwrap=function(e,c,b){b=b||"\n";c=c||75;if(!e){return e}var d=".{1,"+c+"}(\\s|$)|\\S+?(\\s|$)";return e.match(RegExp(d,"g")).join(b)};a.image_by_css=function(c){var d=$('<span class="'+c+'"></span>');$(document.body).append(d);var b=d.css("background-image");if(b=="none"){return""}d.remove();return b.replace("url(","").replace(")","").replace(/\"/gi,"")};return a})(RMPlus.Utils||{});$(document).ready(function(){$(document.body).on("change","select.rmp-fast-edit",function(){var c=$(this);var a=c.val();if(parseInt(a)){var d=c.attr("data-edit-url").split("0").join(a);c.data("rmp-fast-link").attr("href",d)}else{var b=c.attr("data-add-url");c.data("rmp-fast-link").attr("href",b)}});RMPlus.Utils.append_fast_links();$(document.body).on("click","#acl-icons-select",function(a){$("#acl-icon-files").trigger("click");a.preventDefault();return false});$(document.body).on("change","#acl-icon-files",function(){if(!this.files||this.files.length==0){alert(this.getAttribute("data-no-files"));return}var j=$("#acl-upload-icons");j.find(".thumbnails").remove();j.hide().parent().prepend('<div class="loader"></div>');$("#acl-icons-submit").prop("disabled",true);$("#errorExplanation").remove();var b=0;var i="";var d=(this.getAttribute("data-resolution")||"").split("x");var e=function(l){var k=j.find(".thumbnails");if(k.length==0){k=$('<div class="thumbnails"></div>');j.append(k)}k.append('<div class="lb-attach-cont"><div class="lb-attach-bg" style="display: block; background-image: url('+l.src+"); background-repeat: no-repeat; width: "+d[0]+"px; height: "+d[1]+'px;"></div></div>')};var h=function(){j.show().parent().find(".loader").remove();$("#acl-icons-submit").prop("disabled",j.find(".thumbnails .lb-attach-cont").length==0);if(i&&i.length>0){j.parents(".modal-body").prepend('<div id="errorExplanation"><ul>'+i+"</ul></div>")}};var g=function(l){var k=new FileReader;k.onload=function(){var m=new Image;m.onload=function(){var n=$("#acl-icon-files");if(this.width>d[0]||this.height>d[1]){i+="<li>"+this.file.name+" - "+n.attr("data-resolution-exceed")+"</li>"}else{e(this);this.file.valid=true}b+=1;if(b==n.get(0).files.length){b=-1;h()}};m.file=this.file;m.src=this.result};k.file=l;k.readAsDataURL(l)};var f=this.getAttribute("accept").split(",")||[];for(var a=0;a<this.files.length;a++){var c=(this.files[a].name.split(".")||[]).pop();if(f.indexOf(this.files[a].type)==-1&&f.indexOf(c)==-1&&f.indexOf("image/"+c)==-1){i+="<li>"+this.files[a].name+" - "+this.getAttribute("data-not-available-ext")+"</li>";b+=1}else{if(this.files[a].size>parseInt(this.getAttribute("data-filesize"))){i+="<li>"+this.files[a].name+" - "+this.getAttribute("data-filesize-exceed")+"</li>";b+=1}else{g(this.files[a])}}}if(b==this.files.length){b=-1;h()}});$(document.body).on("click","#acl-icons-submit",function(){var h=$(this);h.after('<div class="loader" style="width:'+h.outerWidth().toString()+"px; height: "+h.outerHeight().toString()+'px;"></div>');h.hide();h.parents(".modal:first").find(":input").prop("disabled",true);$(document.body).data("acl_icon_upload_icons",h);$("#errorExplanation").remove();var f=$("#acl-icon-files");var b=f.get(0).files;var e=[];var c=f.attr("data-upload-url");var d=0;var j="";var g="";var i=function(l){if(d>=e.length){d=-1;$(document.body).data("acl_icon_upload_icons").show().nextAll(".loader").remove();var m=l;m.find(":input").prop("disabled",false);if(j&&j.length>0){m.find(".modal-body").prepend('<div id="errorExplanation"><ul>'+j+"</ul></div>")}else{$("#content").find(".flash").remove();$("#content").prepend('<div class="flash notice">'+f.attr("data-success")+"</div>");m.modal("hide")}if(g){$("#acl-generated-icons").remove();$(document.head).append(g)}}};var k=function(l,m){var n=new FormData();n.append("css_icon",m);$.ajax({type:"POST",url:l,processData:false,contentType:false,data:n}).done(function(o){g=o}).fail(function(o){if(o&&o.responseText.length>0){j+="<li>"+o.responseText+"</li>"}}).always(function(){d++;i($("form[action='"+l+"']").parent().parent())})};var a=0;for(a=0;a<b.length;a++){if(b[a].valid){e.push(b[a])}}for(a=0;a<e.length;a++){k(c,e[a])}i($("form[action='"+c+"']").parent().parent())})});