var draw_gantt=null;var draw_top;var draw_right;var draw_left;var rels_stroke_width=2;function setDrawArea(){draw_top=$("#gantt_draw_area").position().top;draw_right=$("#gantt_draw_area").width();draw_left=$("#gantt_area").scrollLeft()}function getRelationsArray(){var a=new Array();$.each($("div.task_todo[data-rels]"),function(f,d){var b=$(d).attr("id");if(b!=null){var c=b.replace("task-todo-issue-","");var e=$(d).data("rels");for(rel_type_key in e){$.each(e[rel_type_key],function(h,g){a.push({issue_from:c,issue_to:g,rel_type:rel_type_key})})}}});return a}function drawRelations(){var a=getRelationsArray();$.each(a,function(i,f){var d=$("#task-todo-issue-"+f.issue_from);var j=$("#task-todo-issue-"+f.issue_to);if(d.size()==0||j.size()==0){return}var n=d.height();var g=d.position().top+(n/2)-draw_top;var o=d.position().left+d.width();var l=j.position().top+(n/2)-draw_top;var m=j.position().left;var e=issue_relation_type[f.rel_type]["color"];var h=issue_relation_type[f.rel_type]["landscape_margin"];var b=o+h;var k=m-h;draw_gantt.path(["M",o+draw_left,g,"L",b+draw_left,g]).attr({stroke:e,"stroke-width":rels_stroke_width});if(b<k){draw_gantt.path(["M",b+draw_left,g,"L",b+draw_left,l]).attr({stroke:e,"stroke-width":rels_stroke_width});draw_gantt.path(["M",b+draw_left,l,"L",m+draw_left,l]).attr({stroke:e,"stroke-width":rels_stroke_width})}else{var c=l+(n*((g>l)?1:-1));draw_gantt.path(["M",b+draw_left,g,"L",b+draw_left,c]).attr({stroke:e,"stroke-width":rels_stroke_width});draw_gantt.path(["M",b+draw_left,c,"L",k+draw_left,c]).attr({stroke:e,"stroke-width":rels_stroke_width});draw_gantt.path(["M",k+draw_left,c,"L",k+draw_left,l]).attr({stroke:e,"stroke-width":rels_stroke_width});draw_gantt.path(["M",k+draw_left,l,"L",m+draw_left,l]).attr({stroke:e,"stroke-width":rels_stroke_width})}draw_gantt.path(["M",m+draw_left,l,"l",-4*rels_stroke_width,-2*rels_stroke_width,"l",0,4*rels_stroke_width,"z"]).attr({stroke:"none",fill:e,"stroke-linecap":"butt","stroke-linejoin":"miter"})})}function getProgressLinesArray(){var a=new Array();var b=$("#today_line").position().left;a.push({left:b,top:0});$.each($("div.issue-subject, div.version-name"),function(g,d){var q=$(d).position().top-draw_top;var f=($(d).height()/9);var c=q-f;var o=q+(f*3);var l=q+(f*8);var j=$(d).children("span").hasClass("issue-closed");var r=$(d).children("span").hasClass("version-closed");if(j||r){a.push({left:b,top:o})}else{var m=$("#task-done-"+$(d).attr("id"));var n=$(d).children("span").hasClass("behind-start-date");var e=$(d).children("span").hasClass("over-end-date");if(e){a.push({left:draw_right,top:c,is_right_edge:true});a.push({left:draw_right,top:l,is_right_edge:true,none_stroke:true})}else{if(m.size()>0){var p=m.first().position().left+m.first().width();a.push({left:p,top:o})}else{if(n){a.push({left:0,top:c,is_left_edge:true});a.push({left:0,top:l,is_left_edge:true,none_stroke:true})}else{var i=b;var k=$("#task-todo-"+$(d).attr("id"));if(k.size()>0){i=k.first().position().left}a.push({left:Math.min(b,i),top:o})}}}}});return a}function drawGanttProgressLines(){var a=getProgressLinesArray();var c=$("#today_line").css("border-left-color");var e;for(e=1;e<a.length;e++){if(!("none_stroke" in a[e])&&(!("is_right_edge" in a[e-1]&&"is_right_edge" in a[e])&&!("is_left_edge" in a[e-1]&&"is_left_edge" in a[e]))){var d=(a[e-1].left==0)?0:a[e-1].left+draw_left;var b=(a[e].left==0)?0:a[e].left+draw_left;draw_gantt.path(["M",d,a[e-1].top,"L",b,a[e].top]).attr({stroke:c,"stroke-width":2})}}}function drawGanttHandler(){var a=document.getElementById("gantt_draw_area");if(draw_gantt!=null){draw_gantt.clear()}else{draw_gantt=Raphael(a)}setDrawArea();if($("#draw_progress_line").prop("checked")){drawGanttProgressLines()}if($("#draw_relations").prop("checked")){drawRelations()}};